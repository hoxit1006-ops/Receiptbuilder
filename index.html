<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Receipt Spending Tracker</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #0f172a;
        --card: #1e293b;
        --muted: #94a3b8;
        --text: #f8fafc;
        --accent: #22c55e;
        --danger: #f87171;
        --info: #38bdf8;
      }
      * { box-sizing: border-box; }
      body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); }
      .app { max-width: 920px; margin: 0 auto; padding: 16px; display: grid; gap: 14px; }
      .card { background: var(--card); border: 1px solid #334155; border-radius: 12px; padding: 14px; }
      h1 { margin: 0; font-size: 1.6rem; }
      h2 { margin: 0 0 8px; font-size: 1.2rem; }
      p { color: var(--muted); margin: 8px 0 0; }
      label { font-size: 0.9rem; color: #cbd5e1; display: block; margin: 8px 0 6px; }
      input, select, button, textarea { width: 100%; border-radius: 10px; border: 1px solid #475569; background: #0b1220; color: var(--text); padding: 10px; font-size: 1rem; }
      textarea { min-height: 96px; }
      button { cursor: pointer; font-weight: 700; }
      .btn-primary { background: var(--accent); color: #042f14; border-color: var(--accent); }
      .btn-secondary { background: #334155; }
      .btn-info { background: var(--info); color: #082f49; border-color: var(--info); }
      .btn-danger { background: var(--danger); color: #200; border-color: var(--danger); }
      .btn-row, .grid-2 { display: grid; gap: 8px; grid-template-columns: 1fr 1fr; }
      .item-row { border: 1px solid #334155; border-radius: 10px; padding: 10px; margin-top: 10px; }
      .items-list, .receipt-list { display: grid; gap: 8px; }
      .chip-row { display: flex; flex-wrap: wrap; gap: 6px; }
      .chip { border: 1px solid #64748b; border-radius: 999px; padding: 4px 10px; font-size: 0.8rem; background: #0f172a; }
      .summary-amount { color: #86efac; font-weight: 800; font-size: 1.25rem; }
      .savings-amount { color: #facc15; font-weight: 700; font-size: 1.05rem; margin-top: 8px; }
      .receipt { border: 1px solid #334155; border-radius: 10px; padding: 10px; }
      .receipt h3 { margin: 0 0 4px; font-size: 1rem; }
      .receipt-delete { margin-top: 8px; }
      .small { color: var(--muted); font-size: 0.88rem; }
      .thumb { width: 100%; max-height: 220px; object-fit: cover; border-radius: 8px; margin-top: 8px; }
      .status { margin-top: 8px; color: #bae6fd; font-size: 0.9rem; }
      .hint { font-size: 0.8rem; color: #93c5fd; margin-top: 6px; }
      @media (max-width: 640px) { .grid-2, .btn-row { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <main class="app">
      <section class="card">
        <h1>Receipt Spending Tracker</h1>
        <p>Take a receipt photo and auto-extract items, prices, categories (fruits â†’ junk food), total spend, and junk-food savings.</p>
      </section>

      <section class="card">
        <h2>Add Receipt</h2>
        <label for="merchant">Store / Merchant</label>
        <input id="merchant" placeholder="e.g. Walmart" />

        <label for="purchaseDate">Date</label>
        <input id="purchaseDate" type="date" />

        <label for="photo">Receipt photo</label>
        <input id="photo" type="file" accept="image/*" capture="environment" />
        <img id="photoPreview" class="thumb" alt="Receipt preview" hidden />

        <div class="btn-row" style="margin-top:8px;">
          <button id="scanReceipt" class="btn-info" type="button">Auto-scan photo</button>
          <button id="addItem" class="btn-secondary" type="button">+ Add item manually</button>
        </div>

        <label for="ocrText" style="margin-top:10px;">Fallback: paste receipt text (if scan misses lines)</label>
        <textarea id="ocrText" placeholder="Paste raw receipt text here, then tap Parse pasted text"></textarea>

        <label for="ollamaModel" style="margin-top:10px;">Optional: Ollama model for better extraction</label>
        <input id="ollamaModel" placeholder="e.g. llama3.1:8b" autocomplete="off" />
        <div class="hint">Requires local Ollama server at http://localhost:11434. Use AI parse when OCR misses items.</div>

        <div class="btn-row" style="margin-top:8px;">
          <button id="parseText" class="btn-secondary" type="button">Parse pasted text</button>
          <button id="aiParse" class="btn-info" type="button">AI parse with Ollama</button>
        </div>

        <div id="scanStatus" class="status"></div>
        <div id="items" class="items-list"></div>

        <div style="margin-top: 10px;">
          <button id="saveReceipt" class="btn-primary" type="button">Save receipt</button>
        </div>
      </section>

      <section class="card">
        <h2>Spending Summary</h2>
        <div class="summary-amount" id="totalSpent">$0.00</div>
        <div class="savings-amount" id="junkSavings">Potential savings (skip junk food): $0.00</div>
        <div id="categorySummary" class="chip-row" style="margin-top: 8px;"></div>
      </section>

      <section class="card">
        <h2>Receipt History</h2>
        <div id="receiptList" class="receipt-list"></div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
